@model BYBY.Services.Models.PlanListModel
@{
    ViewBag.Title = "医生排班管理";
}

<div class="portlet light bordered">
    <div class="portlet-title">
        <div class="caption">
            医生排班管理
        </div>
        <div class="actions">
            <a class="btn btn-circle btn-icon-only btn-default fullscreen" href="javascript:;" data-original-title="" title=""> </a>
        </div>
    </div>

    <div class="portlet-title">
        <div class="querycontent">
            <div class="form-inline" id="query-content">
                <div class="form-group margin-right-10">
                    <button type="button" class="btn blue btn-outline" id="btn-prev-week">
                        <i class="fa fa-angle-left"></i> 上一周
                    </button>
                </div>
                <div class="form-group margin-right-10">
                    <button type="button" class="btn blue btn-outline" id="btn-next-week">
                        下一周 <i class="fa fa-angle-right"></i>
                    </button>
                </div>
                <div class="form-group">
                    <button type="button" class="btn blue btn-outline" id="btn-this-week">
                        本周
                    </button>
                </div>
                <div class="form-group">
                    <label for="search-key">会诊室：</label>
                    @*<select2 id="Hostpital" class="w196" data-placeholder="--请选择医院--" :options="info.HospitalList">
                        </select2>*@
                </div>
            </div>
        </div>

    </div>
    <div class="portlet-body">
        <table class="table  table-bordered plan-table" id="query-table" v-cloak>
            <thead>
                <tr>
                    <th>序号</th>
                    <th>时段</th>
                    <th v-for="week in list.WeekTitles">{{week}}</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(info,index) in list.DateViews">
                    <td>{{index+1}}</td>
                    <td>{{info.STime}} - {{info.ETime}}</td>
                    <td v-for="planView in info.OneDayPlans">
                        <span v-if="planView.Id !=0">{{planView.DoctorName}}/{{planView.People}}</span>
                        <div v-if="editmodel==1" class="form-inline">
                            <select class="selectpicker show-tick" data-width="150px" name="DoctorId">
                                <option value="">无</option>
                                <template v-for="doctor in DoctorList">
                                    <option :value="doctor.id">{{doctor.text}}</option>
                                </template>
                            </select>
                            <input type="text" name="People" style="width:50px" class="form-control">
                        </div>
                    </td>
                </tr>

            </tbody>
            <tfoot>
                <tr>
                    <td colspan="10" class="action">
                        <button type="button" class="btn blue btn-outline margin-right-20" id="btn-edit" v-on:click="showEdit()">
                            <span v-if="editmodel==0">编辑</span>
                            <span v-else>取消编辑</span>
                        </button>
                        <button type="button" class="btn blue btn-outline" v-if="editmodel==1" id="btn-save">
                            保存
                        </button>
                    </td>
                </tr>
            </tfoot>
        </table>

    </div>
</div>



@section styles
{
    @System.Web.Optimization.Styles.Render("~/bundles/css/bootstrapselect")
}

@section pagejs
{
    @System.Web.Optimization.Scripts.Render("~/bundles/js/bootstrapselect")
    @System.Web.Optimization.Scripts.Render("~/bundles/js/jqueryvalidate")
    @System.Web.Optimization.Scripts.Render("~/bundles/js/jqueryform")
    <script>
        $(function () {
            var vuetable = null;
            var dateSelect = null;
             var allData = @Html.RenderAsJson(Model);
             com.showLog(allData,"默认")

            var search = function (weekSelect, roomId) {
                var para = {};
                para.WeekSelect = weekSelect;
                para.DateSelect = dateSelect;
                com.showLog(para,"查询参数");
                com.ajaxquery("/Hospital/QueryPlan", para).then(function (mydata) {

                    com.showLog(mydata);
                    if (vuetable == null) {
                        vuetable = new Vue({
                            el: '#query-table',
                            data: {
                                list: mydata,
                                editmodel: 0,
                                DoctorList: allData.DoctorList
                            },
                            mounted: function () {

                            },
                            methods: {
                                showEdit: function () {
                                    if (vuetable.editmodel == 0) {
                                        vuetable.editmodel = 1;
                                    }
                                    else {
                                        vuetable.editmodel = 0;
                                    }
                                }
                            }

                        })
                    }
                    else {
                        vuetable.list = mydata;
                        dateSelect = mydata.DateSelect;
                    }
                });
            };





            $("#query-content").on("click", "#btn-prev-week", function () {
                search(1);
            }).on("click", "#btn-next-week", function () {
                search(2);
            }).on("click", "#btn-this-week", function () {
                search(3);
            });



            /*******************************初始执行方法***********************************/
            search(3, 0)

        });
    </script>
}

